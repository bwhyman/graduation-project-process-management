# Graduation Project Process Management

### 基础功能

所有角色用户登录操作  
学生默认账号密码均为学号  
为保证安全，登录时检测到账号密码相同会要求修改密码，可忽略  
加密用户角色，基于解密的角色完成用户独有操作    
密码加密保存

### 选导师

#### 学生

未到开始时间无法选择  
开始后未选择，选择数量未满的指导教师  
开始后已选择，选择后不可更改；禁止已选学生改选

#### 教师

查看已选自己学生；查看所有未选/已选学生情况；导出信息excel表格

#### 管理员

独立角色，无教师操作权限  
设置开始时间；导入学生表格，导入教师表格(姓名/账号/数量/分组等)；重置密码等

#### 实现

未开始加载教师信息(带学生数量)但不可选择提交；  
后端保证并发操作的数据完整性，处理，学生不存在/教师不存在/教师数量已满(独占)/重复选择/开始前提交等逻辑判断；

简化以上冗余逻辑。学生不存在，token中解密出因此必然存在无需再次判断；
教师不存在，在更新时已基于ID查询不存在无法更新，但无法提供精确反馈信息，鉴于此场景属极端情况可忽略。  
并发下教师数量已满，返回新的教师信息列表，减少前端网络请求；  
提交成功后返回指导教师信息，不再加载选择列表减少数据请求；

### 分组/排序

选导师后将学生分组。原则，学生与指导教师不在同组。

需提前确定教师分组(导入教师时包含组，无指导学生教师也添加，带学生数为0)。前端完成，直接乱序生成组内顺序。

#### 实现

直接前端实现分组。遍历指导教师下学生，插入到其他组随机位置实现排序，动态显示结果，提交后端保存；

### 评分

毕业设计包含若干过程(开题答辩/期中检查/毕业答辩/演示)，过程100分按比例包含若干打分项；不同过程由学生所在组评审或指导教师打分。  
过程/项/比例等均为动态添加。

#### 实现

过程不支持打分，过程至少包含一个打分项；  
前端判断项分数之和为100；  
打分粒度为过程整体而非项，授权给组内评审或指导教师，加载指定过程时按类型加载对应学生，组学生或指导学生；    
添加过程启止时间节点？  
逆向打分分解？

过程包含的项以json数组保存，通过每项中的number区分不基于ID。  
教师对学生过程的评分项以json数组保存。

### 过程文档管理

学生上传电子版开题/毕设报告，评审浏览评分？  
01-李明-开题报告

### 转组 & 创建新组

支持将学生/评审转入不同的组。

需要为二次答辩学生创建新组。

### Technologies

OpenJDK ^17  
springboot ^3.0.1  
spring-data-r2dbc   
spring-webflux   
asyncer-io    
MySQL 8.0.32

尝试了redis 7。spring-redis不支持原生JSON，redis官方OM框架支持有限且很不灵活。  
还是使用已原生支持JSON的MySQL，采用SQL/NoSQL混合开发模式。

[技术笔记](./techs.md)

### update
#### 2024.01.02
允许学生上传多文件。学生可上传答辩PPT，答辩时在教师机系统直接下载文件，避免排队复制。  
教师在教师机登录，切换到学生下载文件功能，自动隐藏其他功能，避免学生操作看到分数。  
完成小组学生基于所有过程分数的总成绩统计。  
完成全部学生包含过程分数/单项分数的总成绩统计。  
改为组件加载时获取当前屏幕宽度，确定评分对话框尺寸，感觉无需一直动态监听消耗资源。

#### update 2023.09.14
将学生选导师改为基于成绩/数量等规则随机分配  
优化随机分组算法。自动按每组平均数分组，避免某组随机分配数量过多，需多次手动刷新平衡的问题
实现教师基于过程项评分，便于计算达成度  
实现学生上传过程文档，评委下载审阅

#### update 2023.08.18
使用spring-cache缓存开始时间/过程/分组学生等